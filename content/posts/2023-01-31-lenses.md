---
title: "Lenses"
date: 2023-01-25
draft: false
---
# Introduction

Modern IT systems have grown increasingly complex over time. Engineers have continuously expanded and layered abstractions to meet the demands of high availability and business needs. This complexity is a natural outcome of how the IT industry implements solutions.

This growth in complexity has led engineers, the individuals responsible for these systems, to develop intricate mental models to comprehend, operate, and further develop the systems they manage. During incidents, mismatches between an engineer's mental model and the actual state or structure of the system often consume a significant portion of the incident resolution time. In some cases, such mismatches can even trigger incidents or security vulnerabilities. The act of understanding a system is often equated with parsing information and forming a mental model, yet it is typically just a preliminary step[^1].

# Existing Shortcomings

Despite the escalation of system complexity, there hasn't been a commensurate investment in secondary systems to aid engineers in understanding the primary systems they operate. While monitoring, alarming, and visualization tools have evolved, they have not kept pace with the growing complexity of primary systems. Meanwhile, the effort required to construct a mental model of a given system has continued to rise.

In popular science fiction shows and movies, we often witness characters navigating systems with complexity akin to contemporary IT systems. However, these depictions are designed for general audiences, requiring viewers to develop a basic mental model of the system's state. The visualization of complex sci-fi systems differs significantly from the visualization of real-world systems of similar complexity. It employs a more intuitive and direct language, optimized for clarity. Strangely, we prioritize ease of understanding for TV viewers but neglect the same principle when it comes to real systems that depend on human comprehension.

The visualization of present-day IT systems has not kept up with their complexity because engineers have become accustomed to forming a mental image of the system based on the visualization and then working from there, rather than expecting the visualization itself to be readily comprehensible. We consider it part of the job to grasp the fundamentals of a given system instantly, even though machines could assist us more effectively if we taught them how.

Furthermore, secondary systems are typically maintained separately from the primary systems. Documentation is written before or after changes, rarely by the same mechanism implementing the change. Monitoring configurations are manually edited for individual resources, rather than being built from reusable components. Even when monitoring configurations are generated automatically, this is rarely the case for other visualization systems.

To bridge the gap between systems and their visual representations as tools for understanding, we must view visualization not as a separate entity but as a product derived from the same source as the actual system. Moreover, we must make these representations as easily understandable as possible, minimizing the effort required to construct a mental model.

# A Conceptual Framework

IT systems essentially comprise a structure consisting of specific components. This structure can manifest as, for instance, a database composed of virtual machines with attached volumes within a specific subnet. These structures are generated through a machine-readable definition, often created by a pipeline running Terraform.

Over time, the operation of these structures results in a certain state, encompassing aspects like memory usage, disk space, etc., at a given moment. Additionally, we typically hold a set of assumptions about the structure, such as expecting the database's free disk space to remain below a certain threshold for proper functioning.

In most organizations, three secondary systems are implemented and maintained alongside any primary system:

1. Monitoring
2. Metrics
3. Documentation

All three essentially represent visualizations of the primary system, aiding human engineers in constructing a mental model. They are distinct lenses on the same system:

- Documentation visualizes only the structure itself.
- Metrics visualize the structure's state at a particular time.
- Monitoring visualizes whether assumptions about the current state hold true.

All of them constitute various forms of visualization.

![Diagram of concepts](/images/lenses-fig0.png)

# Proposed Solution

We propose that engineers begin to perceive monitoring, metrics, and documentation as slightly different visualizations of the same primary system, akin to lenses focusing on the same object. These visualizations should evolve alongside the structures they represent:

1. Describe and modify the definition in a machine-readable, version-controlled manner.
    - Attach explanatory annotations to specific units of the definition, making them available as metadata for the generated structure.
    - Incorporate assumptions about the state during the structure's lifecycle.
2. Generate all structures from this definition using a reproducible, idempotent mechanism.
3. Generate all visual representations from this definition using a reproducible, idempotent mechanism.
4. Prioritize creating visual, intuitively understandable representations of the structure and its behavior. Design them to overlap with the mental model and structure as closely as possible.

# Example

> 1. Describe and edit the definition in a machine-readable, versionable way.

Imagine building a minimal system comprising two virtual machines, a web application, and its database, all running on a virtualization host. Establish a Git repository housing Terraform manifests describing these elements (structures), including instances, volumes, and subnets.

> - Add explanatory annotations to certain units of the definition. Make them available as metadata for the generated structure.

Include annotations in the Terraform manifests, which are then rendered as metadata fields for the actual cloud instances. These annotations offer concise, human-readable comments about the respective objects, subsequently appearing in documentation and monitoring diagrams.

> - Add assumptions about the state during the structure's lifecycle.

Introduce annotations to the individual components of the manifests, clarifying aspects such as the expected disk space usage for proper system functionality.

The definition should encompass everything known about the system before it goes into operation, as only the state requires measurement.

> 2. Generate all structures from this definition using a reproducible, idempotent mechanism.

Integrate pipelines into the Git project (e.g., GitLab) to provision virtual machines through Terraform in a pipeline.

> 3. Generate all visual representations from this definition using a reproducible, idempotent mechanism.

Extend the pipeline to add representations of all structures to relevant systems. Automatically update operational documentation in the wiki, including architectural diagrams. Modify structure settings in the metrics collection system and adjust thresholds in the monitoring system.

> 4. Make it a top priority to create visual, intuitively understandable representations of your structure and its behavior. Design this so the mental model and structure (including its behavior) overlap as much as possible.

Focus on visualizing frequently used structures. Establish standardized ways to visualize elements like subnets and their current states. Implement these decisions in code and use this code to render system visualizations. Leverage Terraform modules to abstract recurring patterns into reusable modules, such as defining the components of a standard virtual machine (e.g., volumes, memory, CPU cores). Ensure that each module includes a visual representation. This approach allows engineers to quickly identify overloaded instances in a cluster by simply glancing at their visualization in the monitoring system, providing an intuitive and efficient means of system analysis.

Over time, develop a library of modules for building systems and rendering their representations in secondary visualization systems. Engage in discussions among engineers about color representations for various states, highlighting the extent to which they rely on visualizations to offload their mental modeling. Since representations stem from a common source, adjustments to better align with mental models can be collaboratively addressed through merge requests.

# Conclusion

Modern IT

 systems and their associated representations, which engineers rely on to construct mental models for system operation, have diverged. Systems should be built using standardized components, including definitions for structure creation and visual representation across multiple systems, such as monitoring and documentation.

When structures and their representations originate from the same source, they evolve in tandem. Visualizations are pivotal in comprehending and managing IT systems, necessitating their treatment as first-class configuration items. This shift in perspective would steer engineering efforts toward a more abstract yet intuitive and transparent understanding of systems and their behaviors.

Rather than piecing together mental models from fragmented views, we should invest in solutions that facilitate an intuitive understanding of systems.

[^1]: Experience significantly accelerates this process, becoming a source of pride for individual engineers.
